#cloud-config
# Exercise 24 - Cloud-init configuration
# Sets up the server with a DevOps user and SSH access

hostname: ${server_name}
fqdn: ${server_name}.local

users:
  - name: ${devops_username}
    groups: sudo
    shell: /bin/bash
    sudo: ['ALL=(ALL) NOPASSWD:ALL']
    ssh_authorized_keys:
%{ for key in ssh_public_keys ~}
      - ${key}
%{ endfor ~}

package_update: true
package_upgrade: true

packages:
  - vim
  - curl
  - wget
  - git
  - htop
  - nginx

runcmd:
  - systemctl enable nginx
  - systemctl start nginx
  - echo "Server ${server_name} provisioned by Terraform - Exercise 24" > /var/www/html/index.html

final_message: "Cloud-init completed after $UPTIME seconds"
