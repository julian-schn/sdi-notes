# 26 - Testing your web certificate

> **Working Code:** [`terraform/exercise-26-testing-certificate/`](https://github.com/julian-schn/sdi-notes/tree/main/terraform/exercise-26-testing-certificate/)

Create a host among with three corresponding DNS entries:

1.  `g3.sdi.hdm-stuttgart.cloud`
2.  `www.g3.sdi.hdm-stuttgart.cloud`
3.  `mail.g3.sdi.hdm-stuttgart.cloud`

Your Terraform setup shall contain the following `config.auto.tfvars` allowing for an arbitrary number of DNS names:

```hcl
dnsZone       = "g3.sdi.hdm-stuttgart.cloud"
serverNames   = ["www", "cloud"]
```

Install the Nginx web server. Modify the Nginx configuration to accept https requests using the certificate being generated in [Creating a web certificate](./25-web-certificate).

> [!TIP]
> The Nginx default configuration already contains a self signed certificate being referred to by `/etc/nginx/snippets/snakeoil.conf`. In `/etc/nginx/sites-available/default` all SSL supporting statements are yet being commented out:

```nginx
# SSL configuration
#
# listen 443 ssl default_server;
# listen [::]:443 ssl default_server;
...
# Self signed certs generated by the ssl-cert package
# Don't use them in a production server!
#
# include snippets/snakeoil.conf;
```

After modifying the above configuration check for correctness:

```bash
root@www:~# nginx -t
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful
```

Correct any misconfiguration issues before restarting Nginx:

```bash
systemctl restart nginx
```

Your current staging certificate will cause warnings. Point your browser to `https://g3.sdi.hdm-stuttgart.cloud`, `https://g3.sdi.hdm-stuttgart.cloud` and `https://g3.sdi.hdm-stuttgart.cloud` anyway. Overrule certificate related warnings to actually see the three pages. Inspect the certificate. You should find `g3.sdi.hdm-stuttgart.cloud` and `*.g3.sdi.hdm-stuttgart.cloud`.

If your certificate is basically alright re-generate it this time using the production setting `https://acme-v02.api.letsencrypt.org/directory` in [Creating a web certificate](./25-web-certificate). **Don't forget reverting back to staging after completion.** You may regret it!

Copy the generated certificate to your server again. This time your browser should present a flawless view with respect to the underlying certificate for all three URLs.
